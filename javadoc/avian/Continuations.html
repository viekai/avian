<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Wed Apr 23 23:01:25 UTC 2014 -->
<title>Continuations (Avian v0.7 Class Library API)</title>
<meta name="date" content="2014-04-23">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Continuations (Avian v0.7 Class Library API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><em>Avian v0.7</em></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../avian/ConstantPool.PoolEntry.html" title="interface in avian"><span class="strong">Prev Class</span></a></li>
<li><a href="../avian/Data.html" title="class in avian"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?avian/Continuations.html" target="_top">Frames</a></li>
<li><a href="Continuations.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">avian</div>
<h2 title="Class Continuations" class="title">Class Continuations</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="../java/lang/Object.html" title="class in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>avian.Continuations</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">Continuations</span>
extends <a href="../java/lang/Object.html" title="class in java.lang">Object</a></pre>
<div class="block">This class provides methods to capture continuations and manage
 control flow when calling continuations.

 <p>A continuation is a snapshot of a thread's call stack which can
 be captured via <code>callWithCurrentContinuation</code> and later
 restored any number of times.  The program may restore this
 snapshot by either feeding it a result (to be returned by
 <code>callWithCurrentContinuation</code>) or feeding it an
 exception (to be thrown by
 <code>callWithCurrentContinuation</code>).  Continuations may be
 used to implement features such as coroutines, generators, and
 cooperative multitasking.

 <p>This class provides two static methods,
 <code>callWithCurrentContinuation</code> and
 <code>dynamicWind</code>, with similar semantics to the Scheme
 functions <code>call-with-current-continuation</code> and
 <code>dynamic-wind</code>, respectively.  In addition, we define
 how continuations work with respect to native code, exceptions,
 try/finally blocks, synchronized blocks, and multithreading.

 <h3>Continuations and Continuation Contexts</h3>

 <p>A continuation can be thought of as a singly-linked list of
 stack frames representing the call trace, where the head of the
 list is the frame of the method most recently called (i.e. the top
 of the stack).  However, this trace only extends as far as the most
 recent chain of Java frames - it ends just prior to the most recent
 native frame in the stack.  The reason for this is that the VM
 cannot, in general, safely capture and restore native frames.
 Therefore, each call from native code to Java (including the
 original invocation of <code>main(String[])</code> or
 <code>Thread.run()</code>) represents a new continuation context in
 which continuations may be captured, and these will only contain
 frames from within that context.

 <p>Calling a continuation (i.e. feeding it a result or exception)
 causes the current continuation to be replaced with the called
 continuation.  When the last method in this new continuation
 returns, it returns to the native frame which created the current
 context, which may or may not be the same as the context in which
 that continuation was created.

 <p>We define the return type of a continuation context as the
 return type of the first method called in that context.  A
 continuation may be called from a different context than the one in
 which it was created, provided the return type of the latter is
 compatible with the current context.

 <p>Given a thread executing in context "A" which wants to call a
 continuation created in context "B", the following rules apply:

 <ul>

   <li>If the return type of "A" is <code>void</code>, the return
   type of "B" may be anything, including <code>void</code></li>

   <li>If the return type of "A" is a primitive type, the return
   type of "B" must match exactly</li>

   <li>If the return type of "A" is an object type, that type must
   be assignable from the return type of "B" (i.e. the latter must
   either be the same as the former or a superclass or
   superinterface of it)</li>

 </ul>

 <p>A thread may call a continuation created by a different thread
 provided the return types are compatible.  Multiple threads may
 safely call the same continuation simultaneously without
 synchronization.  Any attempt to call a continuation from a context
 with an incompatible return type will throw an <a href="../avian/IncompatibleContinuationException.html" title="class in avian"><code>IncompatibleContinuationException</code></a>.

 <h3>Winding, Unwinding, and Rewinding</h3>

 <p>Traditionally, Java provides one way to wind the execution stack
 (method calls) and two ways to unwind it (normal returns and
 exception unwinding).  With continuations, we add a new way to
 rewind the stack and a new way to unwind it.

 <p>The call stack of a continuation may share frames with other
 continuations - in which case they share a common history.  When
 calling a continuation "B" from the current continuation "A", the
 VM must unwind past any frames which are in "A" but not in "B" and
 rewind past any frames in "B" but not in "A".  During this
 unwinding and rewinding, control may pass through synchronized and
 try/finally blocks while going down the old stack and up the new
 stack.

 <p>However, unlike the traditional processes of winding and
 unwinding, the VM will ignore these blocks - monitors will not be
 released or acquired and finally blocks will not execute.  This is
 by design.  The purpose of such a block is to acquire a resource,
 such as a file handle or monitor, once before executing a task and
 release it after the task is finished, regardless of how often the
 task might temporarily yield control to other continuations.

 <p>Alternatively, one might wish to acquire and release a resource
 each time control (re)winds to or unwinds from a continuation,
 respectively.  In this case, one may use <code>dynamicWind</code>
 to register functions which will run every time that frame is
 passed, regardless of how the stack is wound or unwound.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static &lt;T&gt;&nbsp;T</code></td>
<td class="colLast"><code><strong><a href="../avian/Continuations.html#callWithCurrentContinuation(avian.Function)">callWithCurrentContinuation</a></strong>(<a href="../avian/Function.html" title="interface in avian">Function</a>&lt;<a href="../avian/Callback.html" title="interface in avian">Callback</a>&lt;T&gt;,T&gt;&nbsp;receiver)</code>
<div class="block">Captures the current continuation, passing a reference to the
 specified receiver.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static &lt;T&gt;&nbsp;T</code></td>
<td class="colLast"><code><strong><a href="../avian/Continuations.html#dynamicWind(java.lang.Runnable, java.util.concurrent.Callable, java.lang.Runnable)">dynamicWind</a></strong>(<a href="../java/lang/Runnable.html" title="interface in java.lang">Runnable</a>&nbsp;before,
           <a href="../java/util/concurrent/Callable.html" title="interface in java.util.concurrent">Callable</a>&lt;T&gt;&nbsp;thunk,
           <a href="../java/lang/Runnable.html" title="interface in java.lang">Runnable</a>&nbsp;after)</code>
<div class="block">Calls the specified "before" and "after" tasks each time a
 continuation containing the call is wound or unwound,
 respectively.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static &lt;B,C&gt;&nbsp;C</code></td>
<td class="colLast"><code><strong><a href="../avian/Continuations.html#reset(java.util.concurrent.Callable)">reset</a></strong>(<a href="../java/util/concurrent/Callable.html" title="interface in java.util.concurrent">Callable</a>&lt;B&gt;&nbsp;thunk)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static &lt;A,B,C&gt;&nbsp;A</code></td>
<td class="colLast"><code><strong><a href="../avian/Continuations.html#shift(avian.Function)">shift</a></strong>(<a href="../avian/Function.html" title="interface in avian">Function</a>&lt;<a href="../avian/Function.html" title="interface in avian">Function</a>&lt;A,B&gt;,C&gt;&nbsp;receiver)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="../java/lang/Object.html" title="class in java.lang">Object</a></h3>
<code><a href="../java/lang/Object.html#clone()">clone</a>, <a href="../java/lang/Object.html#equals(java.lang.Object)">equals</a>, <a href="../java/lang/Object.html#finalize()">finalize</a>, <a href="../java/lang/Object.html#getClass()">getClass</a>, <a href="../java/lang/Object.html#hashCode()">hashCode</a>, <a href="../java/lang/Object.html#notify()">notify</a>, <a href="../java/lang/Object.html#notifyAll()">notifyAll</a>, <a href="../java/lang/Object.html#toString()">toString</a>, <a href="../java/lang/Object.html#wait()">wait</a>, <a href="../java/lang/Object.html#wait(long)">wait</a>, <a href="../java/lang/Object.html#wait(long, int)">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="callWithCurrentContinuation(avian.Function)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>callWithCurrentContinuation</h4>
<pre>public static&nbsp;&lt;T&gt;&nbsp;T&nbsp;callWithCurrentContinuation(<a href="../avian/Function.html" title="interface in avian">Function</a>&lt;<a href="../avian/Callback.html" title="interface in avian">Callback</a>&lt;T&gt;,T&gt;&nbsp;receiver)
                                     throws <a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></pre>
<div class="block">Captures the current continuation, passing a reference to the
 specified receiver.

 <p>This method will either return the result returned by
 <code>receiver.call(Callback)</code>, propagate the exception
 thrown by that method, return the result passed to the
 handleResult(T) method of the continuation, or throw the
 exception passed to the handleException(Throwable) method of the
 continuation.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="dynamicWind(java.lang.Runnable, java.util.concurrent.Callable, java.lang.Runnable)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dynamicWind</h4>
<pre>public static&nbsp;&lt;T&gt;&nbsp;T&nbsp;dynamicWind(<a href="../java/lang/Runnable.html" title="interface in java.lang">Runnable</a>&nbsp;before,
                <a href="../java/util/concurrent/Callable.html" title="interface in java.util.concurrent">Callable</a>&lt;T&gt;&nbsp;thunk,
                <a href="../java/lang/Runnable.html" title="interface in java.lang">Runnable</a>&nbsp;after)
                     throws <a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></pre>
<div class="block">Calls the specified "before" and "after" tasks each time a
 continuation containing the call is wound or unwound,
 respectively.

 <p>This method first calls <code>before.run()</code>, then
 <code>thunk.call()</code>, and finally <code>after.run()</code>,
 returning the result of the second call.  If
 <code>before.run()</code> does not return normally, the second
 and third calls will not happen.  If <code>thunk.call()</code>
 throws an exception, <code>after.run()</code>, will be called
 before the exception is propagated.

 <p>If <code>thunk.call()</code> calls a continuation (directly or
 via a subroutine) which does not include the current call to
 <code>dynamicWind</code>, <code>after.run()</code> will be called
 before control passes to that continuation.  If this call throws
 an exception, the exception will propagate to the current caller
 of <code>dynamicWind</code>.

 <p>If <code>thunk.call()</code> creates a continuation which is
 later called from a continuation which does not include the
 current call to <code>dynamicWind</code>,
 <code>before.run()</code> will be called before control passes to
 that continuation.  As above, if this call throws an exception,
 the exception will propagate to the current caller of
 <code>dynamicWind</code>.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="reset(java.util.concurrent.Callable)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reset</h4>
<pre>public static&nbsp;&lt;B,C&gt;&nbsp;C&nbsp;reset(<a href="../java/util/concurrent/Callable.html" title="interface in java.util.concurrent">Callable</a>&lt;B&gt;&nbsp;thunk)
               throws <a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="shift(avian.Function)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>shift</h4>
<pre>public static&nbsp;&lt;A,B,C&gt;&nbsp;A&nbsp;shift(<a href="../avian/Function.html" title="interface in avian">Function</a>&lt;<a href="../avian/Function.html" title="interface in avian">Function</a>&lt;A,B&gt;,C&gt;&nbsp;receiver)
               throws <a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../java/lang/Exception.html" title="class in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><em>Avian v0.7</em></div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../avian/ConstantPool.PoolEntry.html" title="interface in avian"><span class="strong">Prev Class</span></a></li>
<li><a href="../avian/Data.html" title="class in avian"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?avian/Continuations.html" target="_top">Frames</a></li>
<li><a href="Continuations.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><a href="http://oss.readytalk.com/avian/">http://oss.readytalk.com/avian</a></small></p>
</body>
</html>
